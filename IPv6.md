#

## IPv6導入のきっかけ

新規にキャンパスネットワークを構築することになり、その際にIPv4/IPv6デュアルスタック構成としました。


当時在籍していた会社は、部署の分社化によって成立した会社でした。
オーナーは元の会社と同じですが、経理上の資本関係がないようになりました。


そのため、ネットワークを新規に構成することとなったわけです。

## ネットワーク構成

前職で管理していたネットワークは、インターネット接続されたネットワークが業務用とスマートフォン接続用の二系統、インターネットから隔離されたネットワークが一系統ありました。
これらは、VLANで論理的に隔離され、相互接続はありません。
これらのネットワークの全てをIPv4とIPv6のデュアルスタック化しました。

本稿では、

## インターネット接続側のネットワーク

### プロバイダなど

インターネット接続されテイルネットワークは、業務用のものがソフトバンクの専用線とNURO BIZのデュアルホーム構成です。スマートフォン用はフレッツを足回りとしてOCNのPPPoE接続です。
業務用ネットワークのソフトバンクの専用線は、IPv4のみです。NUROのアドレス割り当てをデュアルスタック化していたので、IPv6でのGWをNURO接続のルータとすることで、

## 設計

設計は、IPv4ベースの物理構成、論理構成のネットワークを、IPv6でもアクセス可能とする、デュアルスタック構成としました。
IPv6のために特別な構造とするのではなく、既存のネットワークをIPv6デモ使えるようにする方向です。




## 固定のIPv6アドレス

さくらインターネットのIPv6アドレスの割り当て規則を参考にしています。というか、そのまま使っています。
元は、IPv4互換アドレス
デュアルスタックでIPアドレス固定の機器のIPv6アドレスは、IPv4アドレスから生成します。プレフィクス64ビット長なので、下位64ビットのホストアドレス部に、IPv4の固定アドレスをそのままの見た目で書き込みます。

たとえば、ある機器の固定IPv4アドレスが192.0.2.1で、IPv6プレフィクスが2001:db8::/64であったとします。
この機器の固定IPv6アドレスは、2001:db8::192:0:2:1/128とします。IPv4アドレスで現れる数値を、16進数に変換せず、見た目優先でそのまま書き込みます。



## わかった問題点

LANのデュアルスタック化をすすめてみてわかったのは、IPv6アドレスの固定割り当てに対応していない機器の存在でした。
そのため、将来IPv6のみに移行する場合、機器の大幅な更新が必要となります。

予算の都合で、譲渡をうけた保守切れのCatalystでLANを構成していました。そのため、CatalystのファームがIPv6に対応していない状態となり、VLAN1の管理ネットワークがIPv4のみの構成となりました。
同様に、導入粘度の古いプリンタ複合機も、IPv4でプリンタサーバと接続しています。

また、購入年度が新しいシチズンのGPSタイムサーバが、IPv6に対応していませんでした。
このサーバはインターネット接続のないネットワークでADに時刻を供給する目的で導入しましたが、ドメインコントローラからのアクセスはIPv4で行うようになっています。

IPv6対応となっている機器でも、ステートレス割り当てのみ対応で、固定的なIPv6アドレス割り当てができないというケースもありました。
エプソンの業務用インクジェットプリンタがこれに該当しました。
この機器については、IPv6機能そのものを使わないようにして、IPv4のみで運用することで対応しました。


## その後
　　　
